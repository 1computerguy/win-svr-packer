{
    "variables": {
      "iso_url": "./ISO/windows-server-2019.iso",
      "iso_checksum": "md5:37c51cc09182237ae2c30c9d8ce3c41e",
      "autounattend": "./windows/unattend/server-2019/autounattend.xml",
      "sysprep": "./windows/unattend/server-2019/unattend.xml",
      "template_name": "WinSrv2019-Template",
      "winrm_username": "{{user `winrm_username`}}",
      "winrm_password":"{{user `winrm_password`}}",
      "output_directory":"Win10-Template",
      "esx_host": "put esxi hostname here",
      "vcenter_host": "put vCenter host name here",
      "vcenter_username": "put vCenter username here",
      "vcenter_password": "put vCenter password here",
      "vcenter_cluster" :"put vCenter cluster name  here",
      "vcenter_datacenter":"put vCenter datacenter name here",
      "vcenter_datastore":"put vCenter datastore name here",
      "vcenter_vmfolder":"put vCenter VMFolder here",
      "vcenter_portgroup":"put vCenter vm network name here"
    },
    "builders": [
      {
        "type": "vsphere-iso",
        "vmname": "Win-Svr - Template",
        "communicator": "winrm",
        "iso_url": "{{user `iso_url`}}",
        "iso_checksum": "{{user `iso_checksum`}}",
        "vcenter_server": "{{ user `vcenter_host` }}",
        "host": "{{ user `esx_host` }},
        "username": "{{ user `vcenter_username` }}",
        "password": "{{ user `vcenter_password` }}",
        "insecure_connection": "true",
        "datacenter": "{{ user `vcenter_datacenter` }}",
        "datastore": "{{ user `vcenter_datastore` }}",
        "cluster": "{{ user `vcenter_cluster` }}",
        "folder": "{{ user `vcenter_vmfolder` }}",
        "vcenter_type": "esx5",
        "headless": false,
        "boot_wait": "2m",
        "winrm_username": "Administrator",
        "winrm_password": "Administrator Password",
        "winrm_timeout": "2h",
        "shutdown_timeout": "2h",
        "shutdown_command": "a:\\sysprep.bat",
        "guest_os_type": "windows9srv-64",
        "CPUs": "4",
        "RAM": "8192",
        "network_adapters": [
          {
            "network": "{{ user `vcenter_portgroup` }}",
            "network_card": "vmxnet3"
          }
        ],
        "disk_controller_type": [ "lsisas1068" ],
        "storage": [
          {
            "disk_size": 122880,
            "disk_controller_index": 0,
            "disk_thin_provisioned": true
          }
        ],
        "vnc_port_min": 5900,
        "vnc_port_max": 5980,
        "version": 16,
        "floppy_files": [
          "{{user `autounattend`}}",
          "./scripts/Fix-Network.ps1",
          "./scripts/Enable-Winrm.ps1"
        ],
        "vmx_data": {
          "RemoteDisplay.vnc.enabled": "false",
          "RemoteDisplay.vnc.port": "5900",
        }
      }
    ],
    "provisioners": [
      {
        "type": "file",
        "source": "{{user `sysprep`}}",
        "destination": "c:/Windows/Temp/unattend.xml"
      },
      {
        "type": "powershell",
        "elevated_user": "Administrator",
        "elevated_password": "Administrator Password",
        "scripts": [
          "./scripts/Install-VMwareTools.ps1",
          "./scripts/Enable-CredSSP.ps1"
        ]
      },
      {
        "type": "windows-update",
        "filters": [
          "include:$true"
        ]
      },
      {
        "type": "windows-restart"
      }
    ]
  }
